<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>–û–±–ª—ñ–∫ –ø–æ—Å–∏–ª–æ–∫</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
* { box-sizing:border-box; }
body { font-family:-apple-system,BlinkMacSystemFont,sans-serif; margin:0; padding:12px; background:#f2f4f7; }
h2 { text-align:center; margin-bottom:10px; }
input, select, button { width:100%; padding:14px; margin:5px 0; font-size:16px; border-radius:12px; border:1px solid #ccc; }
button { background:#007aff; color:white; border:none; }
button.delete { background:#ff3b30; }
button.export { background:#34c759; margin-top:8px; }
button:active { transform:scale(0.98); }
.table-wrapper { margin-top:25px; background:white; padding:10px; border-radius:14px; box-shadow:0 2px 6px rgba(0,0,0,0.05); overflow-x:auto; }
table { min-width:1000px; width:100%; border-collapse:collapse; }
th, td { padding:6px; font-size:12px; text-align:center; border-bottom:1px solid #eee; }
th { background:#007aff; color:white; }
.summary { font-weight:bold; font-size:14px; margin:8px 0; }
</style>
</head>
<body>

<h2>–û–±–ª—ñ–∫ –ø–æ—Å–∏–ª–æ–∫</h2>

<input id="tripName" placeholder="–ù–∞–∑–≤–∞ —Ä–µ–π—Å—É">
<button onclick="createTrip()">–°—Ç–≤–æ—Ä–∏—Ç–∏ —Ä–µ–π—Å</button>

<select id="tripSelect"></select>
<button class="delete" onclick="deleteTrip()">–í–∏–¥–∞–ª–∏—Ç–∏ —Ä–µ–π—Å</button>

<input id="fullName" placeholder="–ü—Ä—ñ–∑–≤–∏—â–µ —Ç–∞ –Ü–º º—è" type="text">
<input id="parcelNumber" placeholder="–ù–æ–º–µ—Ä –ø–æ—Å–∏–ª–∫–∏" type="text" inputmode="numeric" pattern="[0-9]*">
<input id="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" type="tel" inputmode="numeric">
<input id="city" list="citiesList" placeholder="–ú—ñ—Å—Ç–æ" type="text">
<datalist id="citiesList"></datalist>
<input id="branch" placeholder="–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è –ù–æ–≤–æ—ó –ü–æ—à—Ç–∏" type="text">
<input id="places" type="number" inputmode="numeric" placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å –º—ñ—Å—Ü—å">
<input id="volume" type="number" inputmode="decimal" placeholder="–û–± º—î–º–Ω–∞ –≤–∞–≥–∞">
<input id="weight" type="number" inputmode="decimal" placeholder="–§–∞–∫—Ç–∏—á–Ω–∞ –≤–∞–≥–∞">
<input id="price" type="number" inputmode="decimal" placeholder="–¶—ñ–Ω–∞">
<label><input type="checkbox" id="ourPayment"> –ù–∞—à–∞ –æ–ø–ª–∞—Ç–∞</label>
<input id="note" placeholder="–ü—Ä–∏–º—ñ—Ç–∫–∞" type="text">

<button onclick="addParcel()">–î–æ–¥–∞—Ç–∏ –ø–æ—Å–∏–ª–∫—É</button>

<div id="tables"></div>

<script>
// –î–∞–Ω—ñ
let parcels = JSON.parse(localStorage.getItem("parcels"))||[];
let trips = JSON.parse(localStorage.getItem("trips"))||[];
let clients = JSON.parse(localStorage.getItem("clients"))||{};

// –°–ø–∏—Å–æ–∫ –º—ñ—Å—Ç –£–∫—Ä–∞—ó–Ω–∏
const cities = ["–ö–∏—ó–≤","–•–∞—Ä–∫—ñ–≤","–û–¥–µ—Å–∞","–î–Ω—ñ–ø—Ä–æ","–õ—å–≤—ñ–≤","–ó–∞–ø–æ—Ä—ñ–∂–∂—è","–í—ñ–Ω–Ω–∏—Ü—è","–ü–æ–ª—Ç–∞–≤–∞","–ß–µ—Ä–Ω—ñ–≥—ñ–≤","–ß–µ—Ä–∫–∞—Å–∏","–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∏–π","–ñ–∏—Ç–æ–º–∏—Ä","–°—É–º–∏","–†—ñ–≤–Ω–µ","–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫","–¢–µ—Ä–Ω–æ–ø—ñ–ª—å","–õ—É—Ü—å–∫","–£–∂–≥–æ—Ä–æ–¥","–ö—Ä–æ–ø–∏–≤–Ω–∏—Ü—å–∫–∏–π","–ú–∏–∫–æ–ª–∞—ó–≤","–•–µ—Ä—Å–æ–Ω","–ë—ñ–ª–∞ –¶–µ—Ä–∫–≤–∞","–ö—Ä–µ–º–µ–Ω—á—É–∫","–ú–µ–ª—ñ—Ç–æ–ø–æ–ª—å","–ö—Ä–∞–º–∞—Ç–æ—Ä—Å—å–∫","–ë—Ä–æ–≤–∞—Ä–∏","–ö–æ–Ω–æ—Ç–æ–ø","–°—î–≤—î—Ä–æ–¥–æ–Ω–µ—Ü—å–∫","–ú–∞—Ä—ñ—É–ø–æ–ª—å","–ù—ñ–∫–æ–ø–æ–ª—å","–ö–∞–º'—è–Ω–µ—Ü—å-–ü–æ–¥—ñ–ª—å—Å—å–∫–∏–π","–®–æ—Å—Ç–∫–∞","–ù—ñ–∂–∏–Ω","–ë–æ—Ä–∏—Å–ø—ñ–ª—å","–°–ª–æ–≤'—è–Ω—Å—å–∫","–ö–∞–ª—É—à","–ë—É—á–∞","–§–∞—Å—Ç—ñ–≤","–ö–∞—Ö–æ–≤–∫–∞","–ë–µ—Ä–¥—è–Ω—Å—å–∫","–Ü–∑–º–∞—ó–ª","–•—É—Å—Ç","–ü–∞–≤–ª–æ–≥—Ä–∞–¥","–°–∞—Ä–Ω–∏","–Ø–≥–æ—Ç–∏–Ω","–î—Ä–æ–≥–æ–±–∏—á","–ß–æ—Ä—Ç–∫—ñ–≤","–í–∏—à–Ω–µ–≤–µ","–ì–æ—Ä—ñ—à–Ω—ñ –ü–ª–∞–≤–Ω—ñ","–ù–æ–≤–∏–π –†–æ–∑–¥—ñ–ª","–ö–æ–∑—è—Ç–∏–Ω","–ó–∞–ª—ñ—â–∏–∫–∏","–û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ—è","–¢—Ä–æ—Å—Ç—è–Ω–µ—Ü—å","–°—î–≤—î—Ä–æ–¥–æ–Ω–µ—Ü—å–∫","–ü–∞–≤–ª–æ–≥—Ä–∞–¥","–ö–∞–º'—è–Ω–µ—Ü—å-–ü–æ–¥—ñ–ª—å—Å—å–∫–∏–π","–ë–µ—Ä–µ–≥–æ–≤–µ","–°–∫–∞–¥–æ–≤—Å—å–∫","–®–µ–ø–µ—Ç—ñ–≤–∫–∞","–ù–æ–≤–∞ –ö–∞—Ö–æ–≤–∫–∞","–£–º–∞–Ω—å","–°–º—ñ–ª–∞","–ë–µ—Ä–µ–∂–∞–Ω–∏","–†—ñ–≤–Ω–µ","–ö–æ–≤–µ–ª—å","–ö–æ—Ä–æ—Å—Ç–µ–Ω—å","–õ–∏—Å–∏—á–∞–Ω—Å—å–∫","–°–ª–∞–≤—É—Ç–∏—á","–í–æ–ª–æ–¥–∏–º–∏—Ä-–í–æ–ª–∏–Ω—Å—å–∫–∏–π","–ù–æ–≤–æ–∞–π–¥–∞—Ä","–ú–∏—Ä–≥–æ—Ä–æ–¥","–ñ–æ–≤—Ç—ñ –í–æ–¥–∏","–ì–æ—Ä–ª—ñ–≤–∫–∞","–¢–µ—Ä–Ω–æ–ø—ñ–ª—å","–ö—Ä–∞–º–∞—Ç–æ—Ä—Å—å–∫","–ú–∏–∫–æ–ª–∞—ó–≤","–õ—å–≤—ñ–≤","–ú–∞—Ä—ñ—É–ø–æ–ª—å","–ë–∞—Ö–º—É—Ç","–°–ª–æ–≤‚Äô—è–Ω—Å—å–∫","–ë–æ—Ä–∏—Å–ø—ñ–ª—å","–ë—ñ–ª–∞ –¶–µ—Ä–∫–≤–∞","–ö–∏—ó–≤","–ñ–∏—Ç–æ–º–∏—Ä","–†—ñ–≤–Ω–µ","–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∏–π","–ö—Ä–µ–º–µ–Ω—á—É–∫","–ö—Ä–æ–ø–∏–≤–Ω–∏—Ü—å–∫–∏–π","–õ—É—Ü—å–∫","–£–∂–≥–æ—Ä–æ–¥","–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫","–¢–µ—Ä–Ω–æ–ø—ñ–ª—å","–ß–µ—Ä–∫–∞—Å–∏","–ß–µ—Ä–Ω—ñ–≤—Ü—ñ","–ß–µ—Ä–Ω—ñ–≥—ñ–≤","–°—É–º–∏","–ü–æ–ª—Ç–∞–≤–∞","–ó–∞–ø–æ—Ä—ñ–∂–∂—è","–ú–µ–ª—ñ—Ç–æ–ø–æ–ª—å","–û–¥–µ—Å–∞","–•–∞—Ä–∫—ñ–≤","–î–Ω—ñ–ø—Ä–æ"];
const citiesList = document.getElementById("citiesList");
const city = document.getElementById("city");
function filterCities(query){
    citiesList.innerHTML="";
    cities.filter(c=>c.toLowerCase().includes(query.toLowerCase()))
        .forEach(c=>{
            let option=document.createElement("option");
            option.value=c;
            citiesList.appendChild(option);
        });
}
city.addEventListener("input",()=>filterCities(city.value));

// –ê–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
function autoSave(){
    localStorage.setItem("parcels", JSON.stringify(parcels));
    localStorage.setItem("trips", JSON.stringify(trips));
    localStorage.setItem("clients", JSON.stringify(clients));
}

// –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ä–µ–π—Å—É
const tripSelect = document.getElementById("tripSelect");
function createTrip(){
    const name = tripName.value.trim();
    if(!name || trips.includes(name)) return;
    trips.push(name);
    autoSave();
    renderTrips();
    tripName.value="";
}
function deleteTrip(){
    const trip = tripSelect.value;
    if(!trip) return;
    if(!confirm("–í–∏–¥–∞–ª–∏—Ç–∏ —Ä–µ–π—Å —ñ –≤—Å—ñ –ø–æ—Å–∏–ª–∫–∏?")) return;
    trips = trips.filter(t=>t!==trip);
    parcels = parcels.filter(p=>p.trip!==trip);
    autoSave();
    renderTrips();
}

// –î–æ–¥–∞—Ç–∏ –ø–æ—Å–∏–ª–∫—É
function addParcel(){
    const trip = tripSelect.value;
    if(!trip) return alert("–°—Ç–≤–æ—Ä—ñ—Ç—å —Ä–µ–π—Å!");
    parcels.push({
        id: Date.now(),
        trip,
        fullName: fullName.value,
        number: parcelNumber.value,
        phone: phone.value,
        city: city.value,
        branch: branch.value,
        places: Number(places.value||0),
        volume: Number(volume.value||0),
        weight: Number(weight.value||0),
        price: Number(price.value||0),
        ourPayment: document.getElementById("ourPayment").checked,
        note: note.value
    });
    clients[phone.value]=fullName.value;
    autoSave();
    renderTables();
    clearInputs();
}
function clearInputs(){
    document.querySelectorAll("input:not(#tripName)").forEach(i=>i.value="");
    document.getElementById("ourPayment").checked=false;
}

// –í–∏–¥–∞–ª–∏—Ç–∏ –ø–æ—Å–∏–ª–∫—É
function deleteParcel(id){
    parcels = parcels.filter(p=>p.id!==id);
    autoSave();
    renderTables();
}

// –í—ñ–¥–æ–±—Ä–∞–∑–∏—Ç–∏ —Ä–µ–π—Å–∏
function renderTrips(){
    tripSelect.innerHTML="";
    trips.forEach(trip=>{
        let option=document.createElement("option");
        option.value=trip;
        option.textContent=trip;
        tripSelect.appendChild(option);
    });
    renderTables();
}

// –¢–∞–±–ª–∏—Ü—ñ
const tables = document.getElementById("tables");
function renderTables(){
    tables.innerHTML="";
    trips.forEach(trip=>{
        const tripParcels = parcels.filter(p=>p.trip===trip);
        if(tripParcels.length===0) return;
        const totalPrice = tripParcels.reduce((s,p)=>s+p.price,0);
        const totalWeight = tripParcels.reduce((s,p)=>s+p.weight,0);
        const totalPlaces = tripParcels.reduce((s,p)=>s+p.places,0);

        let wrapper=document.createElement("div");
        wrapper.className="table-wrapper";

        wrapper.innerHTML=`
            <h3>${trip}</h3>
            <div class="summary">
                üí∞ –°—É–º–∞: ${totalPrice} –≥—Ä–Ω |
                ‚öñÔ∏è –í–∞–≥–∞: ${totalWeight} –∫–≥ |
                üì¶ –ú—ñ—Å—Ü—è: ${totalPlaces}
            </div>
            <button class="export" onclick="exportExcel('${trip}')">–ï–∫—Å–ø–æ—Ä—Ç Excel</button>
            <table>
            <tr>
                <th>–ü–Ü–ë</th><th>–ù–æ–º–µ—Ä</th><th>–¢–µ–ª–µ—Ñ–æ–Ω</th><th>–ú—ñ—Å—Ç–æ</th><th>–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è</th>
                <th>–ú—ñ—Å—Ü—è</th><th>–û–± º—î–º</th><th>–í–∞–≥–∞</th><th>–¶—ñ–Ω–∞</th><th>–ù–∞—à–∞ –æ–ø–ª–∞—Ç–∞</th><th>‚ùå</th>
            </tr>
            ${tripParcels.map(p=>`
                <tr>
                    <td>${p.fullName}</td>
                    <td>${p.number}</td>
                    <td>${p.phone}</td>
                    <td>${p.city}</td>
                    <td>${p.branch}</td>
                    <td>${p.places}</td>
                    <td>${p.volume}</td>
                    <td>${p.weight}</td>
                    <td>${p.price}</td>
                    <td>${p.ourPayment ? "‚úì" : ""}</td>
                    <td><button class="delete" onclick="deleteParcel(${p.id})">X</button></td>
                </tr>
            `).join("")}
            </table>
        `;
        tables.appendChild(wrapper);
    });
}

// –ï–∫—Å–ø–æ—Ä—Ç Excel —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é
function exportExcel(trip){
    const tripParcels = parcels.filter(p=>p.trip===trip);
    if(!tripParcels.length) return alert("–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –µ–∫—Å–ø–æ—Ä—Ç—É!");
    const headersMap = {fullName:"–ü–Ü–ë", number:"–ù–æ–º–µ—Ä", phone:"–¢–µ–ª–µ—Ñ–æ–Ω", city:"–ú—ñ—Å—Ç–æ", branch:"–í—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è", places:"–ú—ñ—Å—Ü—è", volume:"–û–± º—î–º", weight:"–í–∞–≥–∞", price:"–¶—ñ–Ω–∞", ourPayment:"–ù–∞—à–∞ –æ–ø–ª–∞—Ç–∞", note:"–ü—Ä–∏–º—ñ—Ç–∫–∞"};
    const data = tripParcels.map(p=>{
        let obj={};
        for(let k in headersMap) obj[headersMap[k]] = p[k] || '';
        if(p.ourPayment) obj["–ù–∞—à–∞ –æ–ø–ª–∞—Ç–∞"]="‚úì";
        return obj;
    });
    const ws = XLSX.utils.json_to_sheet(data);
    ws['!cols'] = Object.keys(data[0]).map(k=>({wch:Math.max(...data.map(r=>String(r[k]).length),k.length)+5}));
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, trip);
    XLSX.writeFile(wb, `–†–µ–π—Å_${trip}.xlsx`);
}

// –ê–≤—Ç–æ–∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
phone.addEventListener("blur", function(){
    if(clients[this.value]) fullName.value = clients[this.value];
});

// Enter –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥—É –º—ñ–∂ –ø–æ–ª—è–º–∏
const fields = ["fullName","parcelNumber","phone","city","branch","places","volume","weight","price","note"];
fields.forEach((id,index)=>{
    document.getElementById(id).addEventListener("keydown", function(e){
        if(e.key==="Enter"){
            e.preventDefault();
            if(index<fields.length-1) document.getElementById(fields[index+1]).focus();
            else addParcel();
        }
    });
});

renderTrips();
</script>
</body>
</html>
